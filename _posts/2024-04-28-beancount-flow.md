---
layout: post
title: "精通Beancount：我的财务管理工作流"
description: "近几年使用beancount的一个总结"
category: note
comments: true
tags: [beancount, double-entry]
---

{% include JB/setup %}


## 引言

距离我写《beancount起步》已经快6年半了，那篇文章的第一句是：我已经连续记账 4 年半了。加起来不知不觉我已经坚持记账11年了，在这些年里，我结了婚，出国旅行，生了娃，投资了股票，买了房也租了房，一个家庭会发生的财务活动我几乎都经历了<!--more-->（当然，限于中国）。我发觉在这些年里，每个月【第一个在7号之后的周六】是我最痛苦也最期待的日子，痛苦的是每次balance都会不对，但最后又都对上，偶尔还会赶上银行账单系统升级，导入脚本也要跟着升级。期待的是每次对账完成后，都能清晰地看到自己这一个月来的财务流动，从哪里来，到哪里去，这种清晰度给了我极大的安心感。像是站在山顶上俯瞰整个谷底，所有的一切尽收眼底。尤其是在经历了大大小小的生活变故后，这个习惯让我能够迅速调整自己的财务规划，不至于在风云变幻的经济环境中迷失方向。通过不断的优化和调整，我已经将我的Beancount工作流打磨得近乎完美。现在，我想与大家分享我这些年来积累的心得，希望能帮助到正处于不同人生阶段的你们，无论是刚刚开始记账的新手，还是已经有一定财务管理经验但希望更上一层楼的老手。

在这篇文章中，我将尽量从更高的视角审视家庭财务，减少对细枝末节的描述，而着重分享对于整体结构和策略的洞见。这将是我前两篇文章的补充和提纯，旨在为你的财务管理之旅提供更高瞻远瞩的视角。

## Beancount 基础

假设你已经非常熟悉 beancount 的基本语法（也可以回顾下我的前两篇文章）并且实践了至少一年的记账活动，所以这一节没什么好写的。

## Beancount 设置

首先，我要说的是账户结构的设计。在Beancount中，账户就像是一棵树，它的主干是资产、负债、消费和收入，枝干到多么细致取决于以后你要怎么去统计，去做规划。随着时间的推移，你的生活会发生变化，账户结构也应该随之调整。比如说，当我结婚时，我添加了一个共同账户，并为配偶创建了个人账户。当贷款买房后，我需要添加房子大宗资产来记录月供，提前还款等。孩子出生后，我又添加了儿童用品和医疗的账户。

当然，账户结构只是开始。真正的挑战在于如何高效地处理每日的交易。实际上我在[beancount进阶](/2016/10/beancount-advance.html)已经基本介绍过了每月导入流程，但我会在接下来的章节中概括介绍这一过程。但这不会涉及具体的代码，主要是各个银行的账单系统和格式不同，解析规则各异，另一方面现在ChatGPT 如此方便，相信任何人都能通过GPT的协助完成自定义账单导入。

## 月常对账

在我为数众多的记账规则中，月常对账无疑占据着举足轻重的地位。自从上次写接近这篇文章起，我就遵循这个对账步骤，已经7年没怎么变动过了，说明这套流程还是比较稳定的。

### 第一步：对账日

设定对账日每个月的第一个在7号之后的周六，我会进行月度对账。这个特定的日子不仅保证了银行账单一定就绪，也为我提供了宁静的周末时间来专心对账。例如，如果7号是周五，那么对账日就会是次日的周六。如果你有多张信用卡，账单日不统一也没关系，只要定好每月的一天能导入新的账单就行。

### 第二步：导入账户

账单汇总在几个的银行账户中，我会使用自动化脚本从每个账户导出最新的账单。这些脚本会接管登录、检索和下载账单的繁琐工作。你可以在对账日的当天执行脚本完成下载、导入的操作。这里特别需要注意的一点是有些涉及账户转账要做好去重，例如信用卡还款在信用卡账单又提现，还款账户也会有体现。

PS: 如果是在国内的用户也可以只处理支付宝和微信支付（以及其他一些支付平台）这类电子支付平台的账单，但我旅游有时候会用实体卡消费，所以还是保持了从各个卡账户导入的习惯。

PPS：这里没有提日常现金的处理，仰仗移动支付在国内的兴起，现在几乎没有场景需要带那个叫什么来着，实体钱？所以只有出国旅游才会需要对现金记录（第三次提到 进阶）

### 第三步：归类

交易预处理导出账单后，脚本会自动进行预处理，如自动分类[autobean](https://github.com/SEIAROTg/autobean)、标记tag和备注信息。这样的自动化处理减少了人工干预的需求，提高了效率和准确性。在积累了几个月数据后，这里几乎很少需要手工纠正分类。

### 第四步：设立balance

利用beancount的balance语法将以上涉及到的资产（账户）进行断言，遇到错误不要慌张，这样第五步才有意义。

### 第五步：仔细对账

接下来，我会手动对账，确保每笔交易都正确无误地记录在案。这可能是整个过程最无聊最容易犯错的地方。在这一步中，我会仔细检查每一笔交易，核对金额和分类是否匹配。举个例子，我会核对所有的餐饮支出，确保没有将没有备注的账目归到餐饮支持。或者把一些烂账归到餐饮。另外，所有的大额交易要特别警惕，因为它们往往是低频，第三步的自动归类很可能在这里出错。重复这个过程知道第四步的balance 不再报错。

## 报告和分析

记账的过程我会不断问自己，这么费劲记录的目的是什么，答案很显然，为了定期的分析。

在我精心打磨的Beancount工作流中，报告与分析构成了认知财务健康的重要一环。这不仅仅是数字游戏，而是对未来决策的深思熟虑。

财务报告的生成利用Beancount，我可以轻松生成各类财务报告，它们像一面面镜子，映照出我的收支状态和资金流动。每个月，系统会自动生成包括资产负债表、损益表和现金流量表在内的标准报告，它们为我提供了一个月度的财务快照。例如，通过损益表，我可以追踪特定月份的收入和支出，确保我的预算得到有效执行。

深入分析，明智决策报告的价值在于它们背后的数据分析，它帮助我做出更明智的财务决策。Beancount的查询语言非常强大，我可以用它来挖掘任何我感兴趣的财务细节。比如，我会定期查看我的“娱乐与休闲”类别支出，分析它们与整体预算的比例，以便在必要时进行调整。

定制化的报告每个人的财务状况都是独一无二的，因此我还学会了如何定制化报告，以适应个人的特定需求。Beancount允许我创建自定义的查询，从而生成完全个性化的报告。例如，在还房贷这几年，特别是最近房市下行期间，买房相比租房的盈亏有多大，得出买房决策是否正向。

结语报告和分析是一个持续的过程，而Beancount则为这一过程提供了坚实的支撑。通过不断地学习和探索，我已经能够利用Beancount来塑造更加明智和适应个人需求的财务管理策略。随着时间的推移，我相信我的财务状况将因这些精心的报告和深入的分析而日益壮大。

## 结语

报告与分析章节更是将数据的力量显现无遗。定制化的报告不仅仅是数字的堆砌，它们反映了生活的点点滴滴，体现了个人财务管理的深远影响。无论是对比还房贷与租房的长期经济效益，还是监控净资产增长率和投资回报率，每一个分析都为我的财务决策提供了坚实的基础。

最终，我的Beancount工作流不仅是一系列工具和技术的集合，它更是一种生活方式的体现。它教会了我如何在这个瞬息万变的时代中，保持财务的稳定和清晰。这是一个关于数字、决策和生活的故事，而我相信，随着不断地学习和改进，我的工作流将会随我一起继续成长和进化。
